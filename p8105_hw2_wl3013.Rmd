---
title: "p8105_hw2_wl3013"
author: "Wen Li_wl3013"
date: "2025-09-27"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
```

# Question 1
### Step 1: Clean the data in pol-month.csv
```{r}
polmonth_df = 
  read.csv(
    "pols-month.csv",
    na = c("NA",".","")
  ) |> 
  janitor::clean_names() |> 
  separate(mon,into = c("year","month","day",sep = "-")) |>
  mutate(
    month = month.name[as.integer(month)] 
    ) |> 
  mutate(
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem"
    )) |> 
  select(-prez_gop, -prez_dem, -day)

```

### Step 2: Clean the data in snp.csv
```{r}
snp_df = 
  read.csv(
    "snp.csv", na = c("NA",".","")
  ) |> 
  janitor::clean_names() |> 
  mutate(date = mdy(date)) |> 
  separate(date,into = c("year","month","day",sep = "-")) |>
  mutate(
    month = month.name[as.integer(month)] 
    ) |> 
  arrange(year, month)
```

### Step 3: Clean the data in unemployment.csv
```{r}
unemp_df = 
  read.csv(
    "unemployment.csv", na = c("NA",".","")
  ) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = -year,
    names_to = "month",
    values_to = "unemployment"
  ) |> 
  # Capitalize "month" variable
  mutate(
    month_num = match(str_to_title(month), month.abb),
    month = month.name[month_num]
  ) |> 
  select(-month_num)
```

### Step 4: Merge the datasets
```{r}
# Create a subset for snp, choosing the variables we need for merge
snpsub_df = 
  snp_df |> 
  select(year, month, snp_close = close)

# Change the variable type of "year" from int to chr
unemp_df <- unemp_df |> 
  mutate(year = as.character(year))

merge_df = 
  polmonth_df |> 
  left_join(snpsub_df, by = c("year","month")) |> 
  left_join(unemp_df, by = c("year","month"))
```

Conclusion: 
In snp_df, it contains "year", "month", and "close". In the unemp_df, it contains "year", "month", and "unemployment". The same variables among these data is "year" and "month". 
In the final dataset "merge_df", for the variable "close" from snp_data and "unemployment" from unemp_df, only part of the objects have data value.



# Question 2
### Step 1: Import and clean data from excel
```{r}
# Import "Mr. Trash Wheel" sheet from the excel file and clean the data
mr_df <- read_excel("Trashwheel.xlsx", sheet = "Mr. Trash Wheel", skip = 1) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    tag = "Mr" #Record the source of data
    ) 

# Import "Professor Trash Wheel" sheet
prof_df <- read_excel("Trashwheel.xlsx", sheet = "Professor Trash Wheel", skip = 1) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    year = as.character(year),
    tag = "Prof"
  )

# Import "Captain Trash Wheel" sheet
cap_df <- read_excel("Trashwheel.xlsx", sheet = "Captain Trash Wheel", skip = 1) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    year = as.character(year),
    tag = "Cap"
  )

# Import "Gwynnda Trash Wheel" sheet
gwy_df <- read_excel("Trashwheel.xlsx", sheet = "Gwynnda Trash Wheel", skip = 1) |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    year = as.character(year),
    tag = "Gwy"
  )

```

### Step 2: Combines these datasets into one
```{r}
trashall_df <- bind_rows(mr_df, prof_df, cap_df, gwy_df) |> 
  arrange(year, month, dumpster)
```

### Step 3: Conclude the dataset
```{r}
# Calculate the statistics for answering the questions
prof_weight <- trashall_df |> 
  filter(tag == "Prof") |> 
  summarise(total_weight = sum(weight_tons, na.rm = TRUE)) |> 
  pull(total_weight)

gw_cigs <- trashall_df |> 
  filter(tag == "Gwy", year == 2022, month == "June") |> 
  summarise(total_weight = sum(cigarette_butts, na.rm = TRUE)) |> 
  pull(total_weight)
```
The final dataset contains `r nrow(trashall_df)` observations, with essentials variables regarding these research. For example, each row represents the contents of dumster load, the trash weight in tons, the number of cigarette butts, the number of sports balls, and the time of the data collected.
For the questions, Professor Trash Wheel has collected `r prof_weight` tons of trash, and Gwynnda collected `r gw_cigs` cigarette butts in June 2022.

